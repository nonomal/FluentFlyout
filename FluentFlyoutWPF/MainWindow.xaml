<controls:MicaWindow x:Class="FluentFlyoutWPF.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:tray="http://schemas.lepo.co/wpfui/2022/xaml/tray"
    xmlns:controls="clr-namespace:MicaWPF.Controls;assembly=MicaWPF"
    Height="116" Width="310" Top="-9999"
    WindowStyle="None" mc:Ignorable="d" ShowInTaskbar="False"
    ResizeMode="NoResize" MouseEnter="MicaWindow_MouseEnter"
    ChangeTitleColorWhenInactive="False"
    TextOptions.TextRenderingMode="ClearType" TextOptions.TextFormattingMode="Ideal" 
    FontFamily="Segoe UI Variable, Microsoft YaHei, Microsoft JhengHei, MS Gothic"
    Loaded="MicaWindow_Loaded"
    >
    <Window.Triggers>
        <EventTrigger RoutedEvent="Window.Loaded">
            <EventTrigger.Actions>
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimation Storyboard.TargetProperty="(Window.Top)">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                        <DoubleAnimation Storyboard.TargetProperty="(Window.Opacity)">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger.Actions>
        </EventTrigger>
    </Window.Triggers>

    <Grid>
        <controls:Button x:Name="MediaFlyoutCloseButton"
                         Width="28" Height="28" 
                         Style="{StaticResource MicaWPF.Styles.TransparentButton}"
                         HorizontalAlignment="Right" VerticalAlignment="Top"
                         Margin="0,8,8,0"
                         Click="MediaFlyoutCloseButton_Click"
                         Visibility="Collapsed"  >
            <ui:SymbolIcon Symbol="Dismiss20" Filled="True"/>
        </controls:Button>
        <Grid>
            <Image x:Name="BackgroundImageStyle1" Stretch="UniformToFill" Opacity="1" IsHitTestVisible="False" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5" Visibility="Collapsed" ClipToBounds="True">
                <Image.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.2" ScaleY="1.2"/>
                    </TransformGroup>
                </Image.RenderTransform>
                <Image.Effect>
                    <BlurEffect Radius="50"/>
                </Image.Effect>
                <Image.OpacityMask>
                    <RadialGradientBrush GradientOrigin="0.2,0.5" Center="0.1,0.5" RadiusX="0.7" RadiusY="0.3">
                        <GradientStop Color="#FF000000" Offset="0.0"/>
                        <GradientStop Color="#00000080" Offset="0.75"/>
                        <GradientStop Color="#00000000" Offset="1.0"/>
                    </RadialGradientBrush>
                </Image.OpacityMask>
            </Image>
            <Image x:Name="BackgroundImageStyle2" Stretch="Fill" Opacity="0.8" IsHitTestVisible="False" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5" Visibility="Collapsed" ClipToBounds="True">
                <Image.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.8" ScaleY="1.8"/>
                    </TransformGroup>
                </Image.RenderTransform>
                <Image.Effect>
                    <BlurEffect Radius="200"/>
                </Image.Effect>
                <Image.OpacityMask>
                    <RadialGradientBrush GradientOrigin="0.5,1" Center="0.5,1" RadiusX="0.4" RadiusY="0.7">
                        <GradientStop Color="#FF000000" Offset="0.0"/>
                        <GradientStop Color="#00000000" Offset="1.0"/>
                    </RadialGradientBrush>
                </Image.OpacityMask>
            </Image>
            <Image x:Name="BackgroundImageStyle3" Stretch="UniformToFill" Opacity="0.3" IsHitTestVisible="False" HorizontalAlignment="Center" VerticalAlignment="Center" RenderTransformOrigin="0.5,0.5" Visibility="Collapsed">
                <Image.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform ScaleX="1.2" ScaleY="1.2"/>
                    </TransformGroup>
                </Image.RenderTransform>
                <Image.Effect>
                    <BlurEffect Radius="50"/>
                </Image.Effect>
            </Image>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Margin="12" Orientation="Horizontal">
                    <Border Name="SongImageBorder" CornerRadius="6" BorderThickness="1" BorderBrush="#26FFFFFF" Margin="0" ClipToBounds="True" Width="78" Height="78">
                        <ui:SymbolIcon Name="SongImagePlaceholder" Symbol="MusicNote220" FontSize="40" Filled="True" Foreground="{DynamicResource MicaWPF.Brushes.SystemAccentColorLight2}" Visibility="Collapsed" />
                        <Border.Background>
                            <ImageBrush x:Name="SongImage" Stretch="UniformToFill"/>
                        </Border.Background>
                    </Border>
                    <StackPanel Name="BodyStackPanel" Orientation="Vertical" VerticalAlignment="Center" Width="194">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel Name="SongInfoStackPanel" Margin="12,0,0,0" Orientation="Vertical" VerticalAlignment="Center" Width="182">
                                <TextBlock Name="SongTitle" Text="Song Title" FontSize="14" FontFamily="Segoe UI Variable" FontWeight="Medium" TextTrimming="CharacterEllipsis" />
                                <TextBlock Name="SongArtist" Text="Artist Name" FontSize="14" FontFamily="Segoe UI Variable" FontWeight="Medium" Opacity="0.5" TextTrimming="CharacterEllipsis" />
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Name="ControlsStackPanel" Orientation="Horizontal" HorizontalAlignment="Right" Height="35" Width="184" Margin="12,8,0,0">
                            <!--<ui:Button Name="ControlBack" Icon="{ui:SymbolIcon Previous20, Filled=True}" Width="28" Height="28" Padding="0" CornerRadius="999" Margin="0,0,8,0" Click="Back_Click" Focusable="False"/>-->
                            <controls:Button
                        Height="28" Width="28" Name="ControlBack"
                        Margin="2,0,8,0" Click="Back_Click" Focusable="False"
                        Style="{StaticResource MicaWPF.Styles.TransparentButton}" VerticalAlignment="Center">
                                <ui:SymbolIcon Name="SymbolBack" Symbol="Previous20" Filled="True"/>
                            </controls:Button>
                            <controls:Button
                        Height="32" Width="32" Name="ControlPlayPause"
                        Margin="0,0,8,0" Click="PlayPause_Click" Focusable="False"
                        Style="{StaticResource MicaWPF.Styles.AccentedButton}" VerticalAlignment="Center">
                                <ui:SymbolIcon Name="SymbolPlayPause" Symbol="Pause16" Filled="True"/>
                            </controls:Button>
                            <controls:Button
                        Height="28" Width="28" Name="ControlForward"
                        Margin="0,0,8,0" Click="Forward_Click" Focusable="False"
                        Style="{StaticResource MicaWPF.Styles.TransparentButton}" VerticalAlignment="Center">
                                <ui:SymbolIcon Name="SymbolForward" Symbol="Next20" Filled="True"/>
                            </controls:Button>
                            <controls:Button Name="ControlClose"
                                             Width="28" Height="28"  Margin="0,0,8,0"
                                             Style="{StaticResource MicaWPF.Styles.TransparentButton}"
                                               VerticalAlignment="Center" 
                                             Click="MediaFlyoutCloseButton_Click"
                                             Visibility="Collapsed"  >
                                <ui:SymbolIcon Symbol="Dismiss20" Filled="True" />
                            </controls:Button>
                            <controls:Button
                            Height="28" Width="28" Name="ControlRepeat"
                            Margin="0,0,8,0" Click="Repeat_Click" Focusable="False"
                            Style="{StaticResource MicaWPF.Styles.TransparentButton}" VerticalAlignment="Center">
                                <ui:SymbolIcon Name="SymbolRepeat" Symbol="ArrowRepeatAllOff24" Filled="false" Opacity="0.5" FontSize="18"/>
                            </controls:Button>
                            <controls:Button
                            Height="28" Width="28" Name="ControlShuffle"
                            Margin="0,0,8,0" Click="Shuffle_Click" Focusable="False"
                            Style="{StaticResource MicaWPF.Styles.TransparentButton}" VerticalAlignment="Center">
                                <ui:SymbolIcon Name="SymbolShuffle" Symbol="ArrowShuffleOff24" Filled="false" Opacity="0.5" FontSize="18"/>
                            </controls:Button>
                            <StackPanel Name="MediaIdStackPanel" Orientation="Horizontal" Width="72">
                                <Image x:Name="MediaIdIcon" Width="14" Height="14"/>
                                <TextBlock Name="MediaId" VerticalAlignment="Center" FontSize="10" Width="50" Margin="6,0,0,0" FontWeight="Regular" Opacity="0.25" TextWrapping="Wrap" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                        </StackPanel>
                    </StackPanel>
                </StackPanel>
                <DockPanel Grid.Row="1" x:Name="SeekbarWrapper" HorizontalAlignment="Stretch" Margin="16,0,16,12" LastChildFill="True" VerticalAlignment="Center">
                    <TextBlock Name="SeekbarCurrentDuration" Text="-:--" Opacity="0.5" FontSize="12" DockPanel.Dock="Left" Width="45" Margin="0,0,2,0" TextAlignment="Left" VerticalAlignment="Center" Height="18"/>
                    <TextBlock Name="SeekbarMaxDuration" Text="-:--" Opacity="0.5" FontSize="12" DockPanel.Dock="Right" Width="45" Margin="2,0,0,0" TextAlignment="Right" VerticalAlignment="Center" Height="18"/>
                    <Slider Name="Seekbar" Value="0" Maximum="100" Minimum="0" HorizontalAlignment="Stretch" VerticalAlignment="Center" VerticalContentAlignment="Center" Height="18" PreviewMouseLeftButtonDown="Seekbar_OnPreviewMouseLeftButtonDown" PreviewMouseLeftButtonUp="Seekbar_OnPreviewMouseLeftButtonUp" ValueChanged="Seekbar_OnValueChanged"/>
                </DockPanel>
            </Grid>
        </Grid>

        <tray:NotifyIcon
            LeftClick="nIcon_LeftClick" FocusOnLeftClick="False"
            x:Name="nIcon"
            MenuOnRightClick="True"
            TooltipText="FluentFlyout"
            Icon="/Resources/FluentFlyout2.ico"
            Margin="0,127,0,114">
            <tray:NotifyIcon.Menu>
                <ContextMenu>
                    <ui:MenuItem x:Name="NotifyIconSettings" Header="{DynamicResource TrayIcon_SettingsOption}" Click="openSettings">
                        <ui:MenuItem.Icon>
                            <ui:SymbolIcon Symbol="Settings20"/>
                        </ui:MenuItem.Icon>
                    </ui:MenuItem>
                    <Separator></Separator>
                    <ui:MenuItem x:Name="NotifyIconRepository" Header="{DynamicResource TrayIcon_GitHubRepositoryOption}" Click="openRepository">
                        <ui:MenuItem.Icon>
                            <ui:SymbolIcon Symbol="DocumentChevronDouble20"/>
                        </ui:MenuItem.Icon>
                    </ui:MenuItem>
                    <ui:MenuItem x:Name="NotifyIconReportBug" Header="{DynamicResource TrayIcon_ReportBugOption}" Click="reportBug">
                        <ui:MenuItem.Icon>
                            <ui:SymbolIcon Symbol="Bug20"/>
                        </ui:MenuItem.Icon>
                    </ui:MenuItem>
                    <Separator></Separator>
                    <ui:MenuItem x:Name="NotifyIconQuit" Header="{DynamicResource TrayIcon_QuitOption}" Click="NotifyIconQuit_Click">
                        <ui:MenuItem.Icon>
                            <ui:SymbolIcon Symbol="ArrowExit20"/>
                        </ui:MenuItem.Icon>
                    </ui:MenuItem>
                </ContextMenu>
            </tray:NotifyIcon.Menu>
        </tray:NotifyIcon>
    </Grid>
</controls:MicaWindow>
